---
import { Markdown } from "@astropub/md";
import BlogLayout from "@/layouts/BlogLayout.astro";
import fetchApi from "@/lib/strapi";
import type Blog from "@/interfaces/blog";

export async function getStaticPaths() {
  const blogs = await fetchApi<Blog[]>({
    endpoint: "blogs",
    wrappedByKey: "data",
  });

  return blogs.map((blog) => ({
    params: { slug: blog.slug },
    props: blog,
  }));
}

type Props = Blog;
const blog = Astro.props;

function formatDate(dateStr: string) {
  return new Date(dateStr).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<BlogLayout title={blog.Title}>
  <article class="blog-post">
    <header>
      <h1>{blog.Title}</h1>
      <div class="metadata">
        <time datetime={blog.createdAt}>
          {formatDate(blog.createdAt)}
        </time>
      </div>
    </header>
    <div class="content">
      <!-- Ezoic - incontent_5 - incontent_5 -->
      <div id="ezoic-pub-ad-placeholder-115"></div>
      <script is:inline>
        ezstandalone.cmd.push(function () {
          ezstandalone.showAds(115);
        });
      </script>
      <!-- End Ezoic - incontent_5 - incontent_5 -->
      <Markdown of={blog.Content} />
    </div>
    <footer>
      <div class="post-footer">
        <a href="/blog" class="back-to-blog">‚Üê Back to blog</a>
      </div>
    </footer>
  </article>
</BlogLayout>

<style>
  .blog-post {
    margin: 0 auto;
  }

  header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eaeaea;
  }

  .metadata {
    color: #666;
    font-size: 0.9rem;
  }

  .updated {
    font-style: italic;
  }

  .content {
    margin: 2rem 0;
  }

  .post-footer {
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid #eaeaea;
  }

  .back-to-blog {
    display: inline-block;
    color: #0070f3;
    text-decoration: none;
    font-weight: 500;
  }

  .back-to-blog:hover {
    text-decoration: underline;
  }
</style>
